"use strict";(self.webpackChunksharp_etl_site=self.webpackChunksharp_etl_site||[]).push([[192],{3905:(e,t,r)=>{r.d(t,{Zo:()=>l,kt:()=>m});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var d=a.createContext({}),c=function(e){var t=a.useContext(d),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},l=function(e){var t=c(e.components);return a.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,s=e.originalType,d=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),u=c(r),m=n,_=u["".concat(d,".").concat(m)]||u[m]||p[m]||s;return r?a.createElement(_,i(i({ref:t},l),{},{components:r})):a.createElement(_,i({ref:t},l))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=r.length,i=new Array(s);i[0]=u;var o={};for(var d in t)hasOwnProperty.call(t,d)&&(o[d]=t[d]);o.originalType=e,o.mdxType="string"==typeof e?e:n,i[1]=o;for(var c=2;c<s;c++)i[c]=r[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}u.displayName="MDXCreateElement"},2957:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var a=r(7462),n=(r(7294),r(3905));const s={title:"End to end showcase(Hive)",sidebar_position:2,toc:!0,last_modified_at:new Date("2022-04-09T02:59:57.000Z")},i=void 0,o={unversionedId:"end-to-end-showcase",id:"end-to-end-showcase",title:"End to end showcase(Hive)",description:"\u73af\u5883\u51c6\u5907",source:"@site/docs/end-to-end-showcase.md",sourceDirName:".",slug:"/end-to-end-showcase",permalink:"/SharpETL/cn/docs/next/end-to-end-showcase",editUrl:"https://github.com/SharpData/SharpETL/edit/asf-site/website/docs/docs/end-to-end-showcase.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"End to end showcase(Hive)",sidebar_position:2,toc:!0,last_modified_at:"2022-04-09T02:59:57.000Z"},sidebar:"docs",previous:{title:"Docker setup",permalink:"/SharpETL/cn/docs/next/docker-setup"},next:{title:"End to end showcase(Postgres)",permalink:"/SharpETL/cn/docs/next/end-to-end-showcase-postgres"}},d={},c=[{value:"\u73af\u5883\u51c6\u5907",id:"\u73af\u5883\u51c6\u5907",level:2},{value:"\u8fd0\u884c\u4efb\u52a1",id:"\u8fd0\u884c\u4efb\u52a1",level:2},{value:"\u51c6\u5907\u6e90\u8868",id:"\u51c6\u5907\u6e90\u8868",level:3},{value:"\u8fd0\u884c\u4ece\u6e90\u5230ods\u7684\u4efb\u52a1",id:"\u8fd0\u884c\u4ece\u6e90\u5230ods\u7684\u4efb\u52a1",level:3},{value:"\u8fd0\u884c\u4eceods\u5230dwd\u7684\u4efb\u52a1",id:"\u8fd0\u884c\u4eceods\u5230dwd\u7684\u4efb\u52a1",level:3},{value:"\u8fd0\u884c\u4ecedwd\u5230report\u7684\u4efb\u52a1",id:"\u8fd0\u884c\u4ecedwd\u5230report\u7684\u4efb\u52a1",level:3}],l={toc:c};function p(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"\u73af\u5883\u51c6\u5907"},"\u73af\u5883\u51c6\u5907"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"docker-setup"},"Docker setup"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"docker run --name postgres -e POSTGRES_PASSWORD=postgres -d -p 5432:5432 postgres:12.0-alpine\n")),(0,n.kt)("h2",{id:"\u8fd0\u884c\u4efb\u52a1"},"\u8fd0\u884c\u4efb\u52a1"),(0,n.kt)("h3",{id:"\u51c6\u5907\u6e90\u8868"},"\u51c6\u5907\u6e90\u8868"),(0,n.kt)("p",null,"postgres:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"create schema if not exists sales;\n\ncreate table if not exists sales.order\n(\n    order_sn          varchar(128),\n    product_code      varchar(128),\n    product_name      varchar(128),\n    product_version   varchar(128),\n    product_status    varchar(128),\n    user_code         varchar(128),\n    user_name         varchar(128),\n    user_age          int,\n    user_address      varchar(128),\n    product_count     int,\n    price             decimal(10, 4),\n    discount          decimal(10, 4),\n    order_status      varchar(128),\n    order_create_time timestamp,\n    order_update_time timestamp\n);\n\ncreate table if not exists sales.user\n(\n    user_code    varchar(128),\n    user_name    varchar(128),\n    user_age     int,\n    user_address varchar(128),\n    create_time  timestamp,\n    update_time  timestamp\n);\n\ncreate table if not exists sales.product\n(\n    mid         varchar(128),\n    name        varchar(128),\n    version     varchar(128),\n    status      varchar(128),\n    create_time timestamp,\n    update_time timestamp\n);\n")),(0,n.kt)("p",null,"hive ods:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"create database if not exists ods;\n\ncreate table if not exists ods.t_order\n(\n    order_sn          string,\n    product_code      string,\n    product_name      string,\n    product_version   string,\n    product_status    string,\n    user_code         string,\n    user_name         string,\n    user_age          int,\n    user_address      string,\n    product_count     int,\n    price             decimal(10, 4),\n    discount          decimal(10, 4),\n    order_status      string,\n    order_create_time timestamp,\n    order_update_time timestamp,\n    job_id            string\n) partitioned by (`year` string, `month` string, `day` string);\n\ncreate table if not exists ods.t_user\n(\n    user_code    string,\n    user_name    string,\n    user_age     int,\n    user_address string,\n    create_time  timestamp,\n    update_time  timestamp,\n    job_id       string\n) partitioned by (`year` string, `month` string, `day` string);\n\ncreate table if not exists ods.t_product\n(\n    product_code    string,\n    product_name    string,\n    product_version string,\n    product_status  string,\n    create_time     timestamp,\n    update_time     timestamp,\n    job_id          string\n) partitioned by (`year` string, `month` string, `day` string);\n")),(0,n.kt)("p",null,"hive dwd:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"create database if not exists dwd;\ncreate database if not exists dim;\ncreate table dwd.t_fact_order\n(\n    order_id          string,\n    order_sn          string,\n    product_id        string,\n    user_id           string,\n    product_count     int,\n    price             decimal(10, 4),\n    discount          decimal(10, 4),\n    order_status      string,\n    order_create_time timestamp,\n    order_update_time timestamp,\n    actual            decimal(10, 4),\n    job_id            string,\n    start_time        timestamp,\n    end_time          timestamp,\n    is_latest         string,\n    is_active         string\n) partitioned by (`year` string, `month` string, `day` string);\n\ncreate table if not exists dim.t_dim_product\n(\n    product_id      string,\n    mid             string,\n    name            string,\n    version         string,\n    status          string,\n    create_time     timestamp,\n    update_time     timestamp,\n    job_id          string,\n    start_time      timestamp,\n    end_time        timestamp,\n    is_latest       string,\n    is_active       string,\n    is_auto_created string\n) partitioned by (`year` string, `month` string, `day` string);\n\n\ncreate table if not exists dim.t_dim_user\n(\n    dim_user_id     string,\n    user_info_code  string,\n    user_name       string,\n    user_age        int,\n    user_address    string,\n    create_time     timestamp,\n    update_time     timestamp,\n    job_id          string,\n    start_time      timestamp,\n    end_time        timestamp,\n    is_latest       string,\n    is_active       string,\n    is_auto_created string\n) partitioned by (`year` string, `month` string, `day` string);\n")),(0,n.kt)("p",null,"hive report:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"-- ==report\u5c42 \u534e\u4e3amate40-v2\u771f\u5b9e\u7684\u9500\u91cf\u8868\ncreate database if not exists report;\ncreate table if not exists report.t_fact_order_report_actual(\n    order_sn    varchar(128),\n    product_id  varchar(128),\n    product_code    varchar(128),\n    product_name    varchar(128),\n    product_version varchar(128),\n    product_status  varchar(128),\n    price   decimal(10,4),\n    discount    decimal(10,4),\n    order_status    varchar(128),\n    order_create_time   timestamp,\n    order_update_time   timestamp,\n    actual  decimal(10,4)\n);\n\n-- ==report\u5c42 \u534e\u4e3amate40-v2\u7b97\u4e0av1\u7684\u9500\u91cf\ncreate table if not exists report.t_fact_order_report_latest(\n    order_sn    varchar(128),\n    product_id  varchar(128),\n    product_code    varchar(128),\n    product_name    varchar(128),\n    product_version varchar(128),\n    product_status  varchar(128),\n    price   decimal(10,4),\n    discount    decimal(10,4),\n    order_status    varchar(128),\n    order_create_time   timestamp,\n    order_update_time   timestamp,\n    actual  decimal(10,4)\n);\n")),(0,n.kt)("h3",{id:"\u8fd0\u884c\u4ece\u6e90\u5230ods\u7684\u4efb\u52a1"},"\u8fd0\u884c\u4ece\u6e90\u5230ods\u7684\u4efb\u52a1"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"\u51c6\u5907\u6570\u636e")),(0,n.kt)("p",null,"\u4e3adwd\u63d2\u5165\u9884\u5148\u63d0\u4f9b\u7684\u6570\u636e"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"set hive.exec.dynamic.partition=true;\ntruncate table dwd.t_fact_order;\ninsert into dwd.t_fact_order partition (`year` = '2022', `month` = '04', `day` = '04') (order_id, order_sn, product_id,\n                                                                                        user_id, product_count, price,\n                                                                                        discount, order_status,\n                                                                                        order_create_time,\n                                                                                        order_update_time, actual,\n                                                                                        start_time, end_time, is_active,\n                                                                                        is_latest,\n                                                                                        job_id)\nvalues ('aaa', 'AAA', '3abd0495-9abe-44a0-b95b-0e42aeadc807', '06347be1-f752-4228-8480-4528a2166e14', 12, 20, 0.3, 1,\n        '2022-04-04 10:00:00', '2022-04-04 10:00:00', 19.7, '2022-04-04 10:00:00', null, '1', '1', 1),\n       ('bbb', 'BBB', '3abd0495-9abe-44a0-b95b-0e42aeadc807', '06347be1-f752-4228-8480-4528a2166e14', 12, 10, 0.3, 2,\n        '2022-04-04 11:00:00', '2022-04-04 11:00:00', 9.7, '2022-04-04 11:00:00', null, '1', '1', 1),\n       ('ccc', 'CCC', '3abd0495-9abe-44a0-b95b-0e42aeadc807', '06347be1-f752-4228-8480-4528a2166e14', 12, 30, 0.3, 1,\n        '2022-04-04 12:00:00', '2022-04-04 12:00:00', 29.7, '2022-04-04 12:00:00', null, '1', '1', 1);\n\ntruncate table dim.t_dim_user;\ninsert into dim.t_dim_user partition (year = '2022', month = '04', day = '04') (dim_user_id, user_info_code, user_name,\n                                                                                user_age, user_address, create_time,\n                                                                                update_time,\n                                                                                start_time, end_time, is_active,\n                                                                                is_latest, is_auto_created)\nvalues ('06347be1-f752-4228-8480-4528a2166e14', 'u1', '\u5f20\u4e09', 12, '\u80dc\u5229\u8857\u9053', '2020-01-01 10:00:00', '2020-01-01 10:00:00',\n        '2020-01-01 10:00:00', null, '1', '1', '0');\n\ntruncate table dim.t_dim_product;\n\ninsert into dim.t_dim_product partition (year = '2022', month = '04', day = '04') (product_id, mid, name, version,\n                                                                                   status, create_time, update_time,\n                                                                                   start_time, end_time,\n                                                                                   is_active,\n                                                                                   is_latest, is_auto_created)\nvalues ('3abd0495-9abe-44a0-b95b-0e42aeadc807', 'p1', '\u534e\u4e3a', 'mate40', '\u4e0a\u67b6', '2022-01-01 10:00:00',\n        '2022-01-01 10:00:00', '2022-01-01 10:00:00', '2022-04-04 13:00:00', '0', '0', '0')\n     , ('a9cd4e31-9268-4ee9-94b4-18c5e839a937', 'p1', '\u534e\u4e3a', 'mate40-v2', '\u4e0a\u67b6', '2022-01-01 10:00:00',\n        '2022-04-04 13:00:00', '2022-04-04 13:00:00', null, '1', '1', '0');\n\n")),(0,n.kt)("p",null,"\u51c6\u5907\u6e90\u8868\u6570\u636e"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"truncate table sales.order;\ninsert into sales.order (order_sn, product_code, product_name, product_version, product_status,\n                         user_code, user_name, user_age, user_address, product_count, price, discount, order_status,\n                         order_create_time, order_update_time)\nvalues ('AAA', 'p1', '\u534e\u4e3a', 'mate40', '\u4e0a\u67b6', 'u1', '\u5f20\u4e09', 12, '\u80dc\u5229\u8857\u9053', 12, 20, 0.3, 2, '2022-04-04 10:00:00',\n        '2022-04-08 10:00:00') -- \u6b63\u5e38\u66f4\u65b0\n     , ('DDD', 'p1', '\u534e\u4e3a', 'mate40-v2', '\u4e0a\u67b6', 'u2', '\u674e\u56db', 32, '\u8fce\u5bbe\u8857\u9053', 15, 200, 0.4, 2, '2022-04-08 09:00:00',\n        '2022-04-08 10:00:00'); -- \u65b0\u589e\n")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"\u4e0b\u8f7d\u5df2\u7ecf\u7f16\u8f91\u597d\u7684 ",(0,n.kt)("a",{parentName:"p",href:"https://docs.google.com/spreadsheets/d/1Zn_Q-QUTf6us4RwdgUgBosXL09-D-TowmgwWlDskvlA/edit?usp=sharing"},"excel\u6a21\u677f")," \u5230 ",(0,n.kt)("inlineCode",{parentName:"p"},"~/Desktop")," \u6765\u51c6\u5907\u751f\u6210\u5bf9\u5e94\u7684\u4efb\u52a1\u811a\u672c")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"\u901a\u8fc7\u8fd9\u4e2a\u547d\u4ee4\u751f\u6210\u4efb\u52a1\u811a\u672c"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'./gradlew :spark:run --args="generate-ods-sql -f ~/Desktop/ods.xlsx --output ~/Downloads/sharp-etl/spark/src/main/resources/tasks"\n')),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"\u4f60\u770b\u5230\u5982\u4e0b\u65e5\u5fd7\u8868\u793a\u4efb\u52a1\u811a\u672c\u5df2\u7ecf\u751f\u6210\u597d\u4e86")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-log"},"2022/04/09 15:00:32 INFO  [ETLLogger] - Write sql file to /Users/izhangzhihao/Downloads/sharp-etl/spark/src/main/resources/tasks/sales.order__t_order.sql\n2022/04/09 15:00:32 INFO  [ETLLogger] - Write sql file to /Users/izhangzhihao/Downloads/sharp-etl/spark/src/main/resources/tasks/sales.user__t_user.sql\n2022/04/09 15:00:32 INFO  [ETLLogger] - Write sql file to /Users/izhangzhihao/Downloads/sharp-etl/spark/src/main/resources/tasks/sales.product__t_product.sql\n")),(0,n.kt)("ol",{start:5},(0,n.kt)("li",{parentName:"ol"},"\u51c6\u5907\u8fde\u63a5\u4fe1\u606f")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-properties"},"sales.postgres.url=jdbc:postgresql://localhost:5432/postgres?stringtype=unspecified\nsales.postgres.user=postgres\nsales.postgres.password=postgres\nsales.postgres.driver=org.postgresql.Driver\nsales.postgres.fetchsize=10\n")),(0,n.kt)("ol",{start:6},(0,n.kt)("li",{parentName:"ol"},"\u901a\u8fc7\u811a\u672c\u542f\u52a8\u4efb\u52a1")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./gradlew :spark:run --args=\"batch-job --names=sales.order__t_order --period=1440 --default-start-time='2022-04-08 00:00:00' --once\"\n")),(0,n.kt)("p",null,"\u8fd0\u884c\u7ed3\u679c:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-log"},"Total jobs: 1, success: 1, failed: 0, skipped: 0\nDetails:\njob name: sales.order__t_order SUCCESS x 1\n")),(0,n.kt)("h3",{id:"\u8fd0\u884c\u4eceods\u5230dwd\u7684\u4efb\u52a1"},"\u8fd0\u884c\u4eceods\u5230dwd\u7684\u4efb\u52a1"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"\u4e0b\u8f7d\u63d0\u524d\u51c6\u5907\u597d\u7684",(0,n.kt)("a",{parentName:"p",href:"https://docs.google.com/spreadsheets/d/1CetkqBsXj_E8oZBsws9iGdaJB1QJUajnwqH4FoKhXKA/edit?usp=sharing"},"excel"),"\u5230\u684c\u9762")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"\u901a\u8fc7\u8fd9\u4e2a\u547d\u4ee4\u751f\u6210\u4efb\u52a1\u811a\u672c"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'./gradlew :spark:run --args="generate-dwd-sql -f ~/Desktop/dwd.xlsx --output ~/Downloads/sharp-etl/spark/src/main/resources/tasks"\n')),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"\u4f60\u770b\u5230\u5982\u4e0b\u65e5\u5fd7\u8868\u793a\u4efb\u52a1\u811a\u672c\u5df2\u7ecf\u751f\u6210\u597d\u4e86")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-log"},"2022/04/09 16:14:50 INFO  [ETLLogger] - Write sql file to /Users/izhangzhihao/Downloads/sharp-etl/spark/src/main/resources/tasks/t_order_t_fact_order.sql\n2022/04/09 16:14:50 INFO  [ETLLogger] - Write sql file to /Users/izhangzhihao/Downloads/sharp-etl/spark/src/main/resources/tasks/t_user_t_dim_user.sql\n2022/04/09 16:14:50 INFO  [ETLLogger] - Write sql file to /Users/izhangzhihao/Downloads/sharp-etl/spark/src/main/resources/tasks/t_product_t_dim_product.sql\n")),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"\u901a\u8fc7\u811a\u672c\u542f\u52a8\u4efb\u52a1")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./gradlew :spark:run --args=\"batch-job --names=t_order_t_fact_order --period=1440 --default-start-time='2022-04-08 00:00:00' --once\"\n")),(0,n.kt)("p",null,"\u8fd0\u884c\u7ed3\u679c:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-log"},"Total jobs: 1, success: 1, failed: 0, skipped: 0\nDetails:\njob name: t_order_t_fact_order SUCCESS x 1\n")),(0,n.kt)("h3",{id:"\u8fd0\u884c\u4ecedwd\u5230report\u7684\u4efb\u52a1"},"\u8fd0\u884c\u4ecedwd\u5230report\u7684\u4efb\u52a1"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"\u624b\u52a8\u521b\u5efa\u4e24\u4e2astep\uff0c\u5206\u522b\u4ee3\u8868\u4e24\u4e2areport\u7684\u9700\u6c42, \u534e\u4e3amate40-v2\u771f\u5b9e\u7684\u9500\u91cf\u8868,\u5e76\u5c06\u5176\u653e\u5728",(0,n.kt)("inlineCode",{parentName:"li"},"~/Downloads/sharp-etl/spark/src/main/resources/tasks/"),"\u8def\u5f84\u4e0b\uff0c\u547d\u540d\u4e3a",(0,n.kt)("inlineCode",{parentName:"li"},"order_report_actual_hive.sql"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"-- step=1\n-- source=hive\n--  dbName=dwd\n--  tableName=t_fact_order\n-- target=hive\n--  dbName=report\n--  tableName=t_fact_order_report_actual\n-- writeMode=overwrite\nselect fact.order_sn          as order_sn,\n       dim.product_id         as product_id,\n       dim.mid                as product_code,\n       dim.name               as product_name,\n       dim.version            as product_version,\n       dim.status             as product_status,\n       fact.price             as price,\n       fact.discount          as discount,\n       fact.order_status      as order_status,\n       fact.order_create_time as order_create_time,\n       fact.order_update_time as order_update_time,\n       fact.actual            as actual\nfrom dwd.t_fact_order fact\n         inner join dim.t_dim_product dim\n                    on fact.product_id = dim.product_id\n                        and fact.is_latest = '1';\n")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"\u624b\u52a8\u521b\u5efa\u4e24\u4e2astep\uff0c\u5206\u522b\u4ee3\u8868\u4e24\u4e2areport\u7684\u9700\u6c42, \u534e\u4e3amate40-v2\u7b97\u4e0av1\u7684\u9500\u91cf,\u5e76\u5c06\u5176\u653e\u5728",(0,n.kt)("inlineCode",{parentName:"li"},"~/Downloads/sharp-etl/spark/src/main/resources/tasks/"),"\u8def\u5f84\u4e0b\uff0c\u547d\u540d\u4e3a",(0,n.kt)("inlineCode",{parentName:"li"},"order_report_latest_hive.sql"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"\n-- step=1\n-- source=hive\n--  dbName=dwd\n--  tableName=t_fact_order\n-- target=hive\n--  dbName=report\n--  tableName=t_fact_order_report_latest\n-- writeMode=overwrite\nselect fact.order_sn          as order_sn,\n       dim2.product_id        as product_id,\n       dim2.mid               as product_code,\n       dim2.name              as product_name,\n       dim2.version           as product_version,\n       dim2.status            as product_status,\n       fact.price             as price,\n       fact.discount          as discount,\n       fact.order_status      as order_status,\n       fact.order_create_time as order_create_time,\n       fact.order_update_time as order_update_time,\n       fact.actual            as actual\nfrom dwd.t_fact_order fact\n         inner join dim.t_dim_product dim on fact.product_id = dim.product_id and fact.is_latest = '1'\n         inner join (select * from dim.t_dim_product dim_latest where is_latest = '1') dim2\n                    on dim.mid = dim2.mid and fact.is_latest = '1';\n")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"\u901a\u8fc7\u811a\u672c\u542f\u52a8\u4efb\u52a1")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./gradlew :spark:run --args=\"batch-job --names=order_report_actual_hive,order_report_latest_hive --period=1440 --default-start-time='2022-04-08 00:00:00' --once\"\n")))}p.isMDXComponent=!0}}]);